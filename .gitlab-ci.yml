include:
  - "https://gitlab.com/tomfordweb/gitlab-ci-templates/-/raw/deploy/docker-compose/build.yml"
  - "https://gitlab.com/tomfordweb/gitlab-ci-templates/-/raw/deploy/docker-compose/deploy.yml"

stages:
  - prep
  - build
  - test
  - deploy

test feature:
  stage: test
  script:
    - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $CI_REGISTRY
    # Hacky, but it doesn't matter since the compose file isnt an artifact in this job
    # docker-compose run api does not let you specify
    # custom dockerfiles, it assumes the default docker-compose.yml
    - rm docker-compose.yml
    - cp ${TEST_COMPOSE_FILE} docker-compose.yml
    - docker-compose pull
    # Run frontend tests
    - docker-compose run frontend test
